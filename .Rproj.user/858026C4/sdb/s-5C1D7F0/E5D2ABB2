{
    "collab_server" : "",
    "contents" : "readingSource <- function(which = \"Australia\", filev) {\n  # if (which==\"Australia\") {\n  \n  #source<-read_excel(path=\"./Inputdata/testArgentina.xlsx\", skip=1)\n  \n  source <- read_excel(path = filev, skip = 1)\n  #Selecting all rows with recordID\n  recordID <-\n    source %>% filter(grepl(\"Record\", Trademark)) %>% dplyr::rename(Record_ID =\n                                                                      Trademark) %>%\n    select(Record_ID)\n  \n  recordID <-\n    recordID[rep(seq_len(nrow(recordID)), each = 3), \"Record_ID\"]\n  \n  source <- cbind(recordID, source)\n  \n  source$Record_ID <- gsub(\"Record ID:\", \"\", source$Record_ID)\n  \n  source <- source %>% filter(!grepl(\"Record\", Trademark))\n  \n  source$`Application no.` <- gsub(\"/\", \"\", source$`Application no.`)\n  source$`Application no.` <- gsub(\",\", \"\", source$`Application no.`)\n  #cleaning appno\n  \n  return(source)\n  \n  #  }\n}\n\ndownloadData <- function(Country,\n                         source,\n                         from = NULL,\n                         to = NULL) {\n  #Country=\"Argentina\"\n  \n  dir.create(file.path(\"./logos\"), showWarnings = FALSE)\n  \n  dir.create(file.path(paste(\"./tmpData/\", Country, sep = \"\")), showWarnings = FALSE)\n  \n  unlink(paste(\"./tmpData/\", Country, \"/*.*\", sep = \"\"))\n  \n  sourceAPP <- unique(source$`Application no.`)\n  sourceAPP <- na.omit(sourceAPP)\n  \n  if (is.null(from) | is.null(to))\n  {\n    from <- 1\n    to <- length(sourceAPP)\n  }\n  \n  \n  \n  \n  appNo <- as.list(sourceAPP)[from:to]\n  \n  #If country is US, start Selenium\n  \n  if (Country == \"USA\")\n  {\n    insert(outputConsole, \"Starting Selenium server...\")\n    \n    driver <-\n      try(rsDriver(verbose = FALSE, port = 4445L), silent = TRUE)\n    remDr <- try(driver[[\"client\"]], silent = TRUE)\n    \n    try(remDr$open(silent = TRUE), silent = TRUE)\n  }\n  \n  for (i in 1:length(appNo)) {\n    appNumber <- appNo[[i]]\n    appNumber <- gsub(\",\", \"\", appNumber)\n    appNumber <- gsub(\"/\", \"\", appNumber)\n    appNumber <- gsub(\".\", \"\", appNumber, fixed = TRUE)\n    \n    cat(paste(\"Downloading Trademark \", appNumber, \"...\\n\", sep = \"\"))\n    \n    if (Country == \"Australia\") {\n      try(scrapData <- AUSScrap(appNumber), silent = TRUE)\n    } else if (Country == \"USA\")\n    {\n      localSys <- Sys.getlocale(\"LC_ALL\")\n      \n      Sys.setlocale(\"LC_ALL\", \"english\")\n      \n      try(scrapData <- USScrap(appNumber), silent = FALSE)\n      \n      Sys.setlocale(\"LC_ALL\", localSys)\n      \n    } else if (Country == \"Argentina\")\n    {\n      try(scrapData <- ARScrap(appNumber), silent = FALSE)\n      \n      \n    }\n    \n    if (exists(\"scrapData\") && scrapData$`Application no.`==appNumber) {\n      #Saving into tempData\n      \n      \n      insert(outputConsole,\n             paste(\"Downloading Trademark \", appNumber))\n      \n      filenm = paste(\"./tmpData/\", Country, \"/\", appNumber, \".Rda\", sep = \"\")\n      \n      \n      \n      save(scrapData, file = filenm)\n      try(rm(\"scrapData\"), silent = TRUE)\n      \n    }\n    \n    try(rm(\"scrapData\"), silent = TRUE)\n    \n  }\n  \n  \n  if (Country == \"US\")\n  {\n    try(driver$server$stop(), silent = TRUE)\n    try(remDr$close(), silent = TRUE)\n  }\n  \n  path <- paste(\"./tmpData/\", Country, \"/\", sep = \"\")\n  filename <- paste(\"./data/\", Country, \"_online.xlsx\", sep = \"\")\n  \n  \n  \n  \n  #gather data\n  fileson <- list.files(path = path,\n                        pattern = \"*.Rda\",\n                        full.names = FALSE)\n  fileson <- gsub(\".Rda\", \"\", fileson)\n  data_s = lapply(fileson, function(x) {\n    filenm = paste(path, as.character(x), \".Rda\", sep = \"\")\n    \n    if (file.exists(filenm))\n    {\n        load(filenm)\n         return(scrapData)\n    }\n  })\n  \n  \n  localTime <- Sys.getlocale(\"LC_TIME\")\n  \n  #local time to Australiaan\n  Sys.setlocale(\"LC_TIME\", \"German\")\n\n  dataTmp = as.data.frame(try(do.call(rbind, data_s)))\n  \n  \n  #removing dummy dates\n  dataTmp[dataTmp  ==  \"01.01.1800\"]  <-  NA\n  \n  \n  #changing format\n  Sys.setlocale(\"LC_TIME\", localTime)\n  \n  write.xlsx2(\n    dataTmp,\n    file = filename,\n    sheetName  =  \"verification\",\n    row.names = FALSE\n  )\n  \n  insert(\n    outputConsole,\n    paste(\"Online data are scraped and stored in \", filename)\n  )\n  galert(\n    paste(\"Online data are scraped and stored in \", filename),\n    parent = w\n  )\n  \n  \n}\n",
    "created" : 1506428773939.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1625822833",
    "id" : "E5D2ABB2",
    "lastKnownWriteTime" : 1506444220,
    "last_content_update" : 1506444220,
    "path" : "C:/Users/Godnov/Dropbox/Katarina/Auxillary.R",
    "project_path" : "Auxillary.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}